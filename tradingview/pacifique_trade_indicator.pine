//@version=5
indicator("PacifiqueTrade Indicator 2.0", overlay=true, max_boxes_count=500, max_lines_count=500)

// ============================================================================
// INPUT SETTINGS
// ============================================================================

// FVG Settings
fvgEnabled = input.bool(true, "Show FVG Zones", group="FVG Settings")
fvg3Candle = input.bool(true, "3-Candle FVG (Laminar)", group="FVG Settings")
fvg2Candle = input.bool(true, "2-Candle Imbalance", group="FVG Settings")
fvgHistoryLimit = input.int(20, "FVG History Limit", minval=1, maxval=100, group="FVG Settings")

// Liquidity Sweep Settings
sweepEnabled = input.bool(true, "Show Liquidity Sweeps", group="Sweep Settings")
sweepLookback = input.int(20, "Sweep Lookback Period", minval=5, maxval=100, group="Sweep Settings")
sweepTolerance = input.float(0.1, "Sweep Tolerance %", minval=0.01, maxval=1.0, group="Sweep Settings")

// RSI Settings
rsiEnabled = input.bool(true, "Use RSI Filter", group="Entry Filters")
rsiPeriod = input.int(14, "RSI Period", minval=2, maxval=50, group="Entry Filters")
rsiOverbought = input.float(70, "RSI Overbought", minval=50, maxval=90, group="Entry Filters")
rsiOversold = input.float(30, "RSI Oversold", minval=10, maxval=50, group="Entry Filters")

// Volume Settings
volumeEnabled = input.bool(true, "Use Volume Filter", group="Entry Filters")
volumeMAPeriod = input.int(99, "Volume MA Period", minval=10, maxval=200, group="Entry Filters")
volumeMultiplier = input.float(1.5, "Volume Burst Multiplier", minval=1.0, maxval=5.0, group="Entry Filters")

// Entry Zone Settings
entryZoneEnabled = input.bool(true, "Show Entry Zones", group="Entry Zones")
entryZoneBullColor = input.color(color.new(color.green, 80), "Long Entry Zone", group="Entry Zones")
entryZoneBearColor = input.color(color.new(color.red, 80), "Short Entry Zone", group="Entry Zones")

// Webhook Settings
webhookEnabled = input.bool(false, "Enable Webhook Alerts", group="Webhook")
webhookURL = input.string("", "Webhook URL (Optional)", group="Webhook")

// ============================================================================
// CALCULATIONS
// ============================================================================

// RSI
rsi = ta.rsi(close, rsiPeriod)
rsiOverboughtLevel = rsiEnabled and rsi > rsiOverbought
rsiOversoldLevel = rsiEnabled and rsi < rsiOversold

// Volume
volumeMA = ta.sma(volume, volumeMAPeriod)
volumeBurst = volumeEnabled and volume > volumeMA * volumeMultiplier

// ============================================================================
// FVG DETECTION (3-Candle Laminar Gap)
// ============================================================================

var box[] bullishFVGs = array.new_box()
var box[] bearishFVGs = array.new_box()

// Bullish FVG: candle[2].high < candle[0].low (gap up)
bullishFVG = fvg3Candle and high[2] < low[0]
if bullishFVG
    fvgTop = low[0]
    fvgBottom = high[2]
    fvgLeft = bar_index[1]
    fvgRight = bar_index + 50  // Extend into future
    
    // Create FVG box
    fvgBox = box.new(
        left=fvgLeft, 
        top=fvgTop, 
        right=fvgRight, 
        bottom=fvgBottom,
        border_color=color.new(color.green, 0),
        bgcolor=color.new(color.green, 85),
        border_width=1,
        extend=extend.right,
        text="FVG Bull",
        text_color=color.green,
        text_size=size.small
    )
    
    array.push(bullishFVGs, fvgBox)
    
    // Limit history
    if array.size(bullishFVGs) > fvgHistoryLimit
        oldBox = array.shift(bullishFVGs)
        box.delete(oldBox)

// Bearish FVG: candle[2].low > candle[0].high (gap down)
bearishFVG = fvg3Candle and low[2] > high[0]
if bearishFVG
    fvgTop = low[2]
    fvgBottom = high[0]
    fvgLeft = bar_index[1]
    fvgRight = bar_index + 50
    
    fvgBox = box.new(
        left=fvgLeft,
        top=fvgTop,
        right=fvgRight,
        bottom=fvgBottom,
        border_color=color.new(color.red, 0),
        bgcolor=color.new(color.red, 85),
        border_width=1,
        extend=extend.right,
        text="FVG Bear",
        text_color=color.red,
        text_size=size.small
    )
    
    array.push(bearishFVGs, fvgBox)
    
    if array.size(bearishFVGs) > fvgHistoryLimit
        oldBox = array.shift(bearishFVGs)
        box.delete(oldBox)